import{d as x,u as V,r as f,a as I,c as v,b as a,w as S,e as _,v as w,n as C,t as L,f as g,g as P,h as U,F as B,o as d,_ as D,p as E,i as N,j as F,k as M}from"./index-CqzfxNIE.js";import{E as j,U as A}from"./UserNameValidator-DrCO2tSq.js";import{u as J}from"./fetch-DOn0LP7U.js";const c=l=>(E("data-v-e5153f92"),l=l(),N(),l),O={class:"w-100 container-form"},T={class:"container mx-auto"},$={class:"flex items-center justify-center h-full"},q={class:"w-[30rem]"},z=c(()=>a("h3",{class:"text-center"},"Iniciar sesión",-1)),G={class:"flex flex-col gap-3 mt-5"},H={key:0,class:"text-red-200"},K={class:"password"},Q=c(()=>a("i",{id:"iconPassword",class:"bi bi-eye-fill"},null,-1)),R=[Q],W=c(()=>a("div",{class:"h-[1rem]"},null,-1)),X=x({__name:"LoginView",setup(l){const u=V(),t=f({email:"",password:""}),n=f({username:{isValid:!0,message:""}}),r=I(""),y=()=>{p.validate(t.email)?(n.username.isValid=!0,n.username.message=""):(n.username.isValid=!1,n.username.message=p.invalidMessage())},p=new A,h=()=>{const s=document.getElementById("password-input"),e=document.getElementById("iconPassword");s.type==="password"?(s.type="text",e.classList.remove("bi-eye-fill"),e.classList.add("bi-eye-slash-fill")):(s.type="password",e.classList.remove("bi-eye-slash-fill"),e.classList.add("bi-eye-fill"))},b=async()=>{if(t.email===""||t.password===""){r.value="Por favor, rellene todos los campos";return}const s=new FormData;s.append("username",t.email),s.append("password",t.password),s.append("grant_type",""),s.append("client_id",""),s.append("client_secret",""),s.append("scope","");const{data:e,error:o}=await J("/auth/token",s);if(console.log("Data from login",e.value),console.log("Error from login",o.value),o.value!==""){r.value=o.value;return}else r.value="";if(e.value.access_token){r.value="Usuario o contraseña incorrectos";const i=e.value.access_token,m=k(i);u.user.email=m.email,u.user.token=i,window.localStorage.setItem("userData",btoa(JSON.stringify({token:i,email:m.email}))),F.push({name:"home"});return}};function k(s){const e=s.split(".")[1],o=atob(e);return JSON.parse(o)}return(s,e)=>(d(),v(B,null,[a("div",O,[a("form",{onSubmit:e[2]||(e[2]=S(()=>{},["prevent"]))},[a("div",T,[a("div",$,[a("div",q,[z,a("div",G,[_(a("input",{type:"email",class:C(["border border-gray-300 rounded px-5 py-3",{"border-red-200":!n.username.isValid}]),placeholder:"Correo electrónico","onUpdate:modelValue":e[0]||(e[0]=o=>t.email=o),onFocusout:y},null,34),[[w,t.email]]),n.username.message?(d(),v("p",H,L(n.username.message),1)):g("",!0),a("div",K,[_(a("input",{type:"password",class:"border border-gray-300 rounded px-5 py-3",placeholder:"Contraseña","onUpdate:modelValue":e[1]||(e[1]=o=>t.password=o),id:"password-input"},null,512),[[w,t.password]]),a("div",{class:"btn-password",onClick:h},R)]),W,P(D,{text:"Iniciar sesión",onClick:b})])])])])],32)]),r.value?(d(),U(j,{key:0,show:r.value!=="",message:r.value,onClose:e[3]||(e[3]=o=>r.value="")},null,8,["show","message"])):g("",!0)],64))}}),se=M(X,[["__scopeId","data-v-e5153f92"]]);export{se as default};
