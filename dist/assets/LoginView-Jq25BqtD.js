import{d as M,r as y,c as L,w as b,T as A,o as p,a as C,b as s,e as I,f as h,n as T,_ as R,g as z,u as J,h as n,i as _,j as P,v as S,k as V,F as G,l as H,t as K,p as Q,m as W}from"./index-CVMiIcLg.js";import{P as B,E as X,S as Y}from"./SuccessAlert-D4EoaIXj.js";import{v as D}from"./validateField-BHAg92NY.js";import{a as Z}from"./login-CPXSZuTU.js";const ee={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},se={class:"modal-content"},oe={class:"modal-header d-flex justify-content-between"},ae={class:"modal-body"},te={class:"modal-footer"},le=M({__name:"ModalBase",props:["show","hiddenClose"],emits:["onClose"],setup(l,{emit:f}){const w=f,d=()=>{w("onClose")},t=y("block");return(c,u)=>(p(),L(A,null,{default:b(()=>[l.show?(p(),C("div",{key:0,class:"modal fade show modal-fullscreen-sm-down",style:T({display:t.value}),"aria-modal":"true",role:"dialog"},[s("div",ee,[s("div",se,[s("div",oe,[I(c.$slots,"header",{},void 0,!0),l.hiddenClose?h("",!0):(p(),C("i",{key:0,class:"bi bi-x close-modal",onClick:u[0]||(u[0]=v=>d())}))]),s("div",ae,[I(c.$slots,"body",{},void 0,!0)]),s("div",te,[I(c.$slots,"footer",{},void 0,!0)])])])],4)):h("",!0)]),_:3}))}}),re=R(le,[["__scopeId","data-v-743260cf"]]);async function ne(l){try{if((await z.post("/auth/reset-password",l)).status===200)return}catch{throw new Error("Error al restablecer la contraseña, verifica el correo electrónico")}}const i=l=>(Q("data-v-36bd0cfb"),l=l(),W(),l),ie={class:"w-100 container-form"},de={class:"container mx-auto"},ce={class:"flex items-center justify-center h-full"},ue={class:"w-[30rem]"},me=i(()=>s("h3",{class:"text-center"},"Iniciar sesión",-1)),pe={class:"flex flex-col gap-3 mt-5"},we={class:"password"},ve=i(()=>s("i",{id:"iconPassword",class:"bi bi-eye-fill"},null,-1)),fe=[ve],_e=i(()=>s("div",{class:"h-[1rem]"},null,-1)),ye=i(()=>s("div",{class:"h-[1rem]"},null,-1)),he=i(()=>s("div",{class:"modal-title"},[s("h2",null,"Cambia tu contraseña")],-1)),ge={class:"modal-body"},be=i(()=>s("p",null,"La contraseña debe tener por tu seguridad:",-1)),Ce=i(()=>s("ul",null,[s("li",null,"Debe tener al menos 8 caracteres"),s("li",null,"Debe tener al menos una letra mayúscula"),s("li",null,"Debe tener al menos un número"),s("li",null,"Debe tener al menos un caracter especial (@_.&$)")],-1)),$e={class:"mt-2"},ke={class:"password mt-4"},xe=i(()=>s("i",{id:"iconReset",class:"bi bi-eye-fill"},null,-1)),Ee=[xe],Ie={key:0,class:"text-red-200"},Le=M({__name:"LoginView",setup(l){const f=J(),w=y(!1),d=y(""),t=n({email:"",new_password:""}),c=n({email:!1,new_password:!1}),u=n({email:"",new_password:""}),v=n({email:!1,new_password:!1}),r=n({email:"",password:""}),$=n({email:!1}),k=n({email:""}),x=n({email:!1}),m=y(""),g=y(!1),j=()=>{const o=document.getElementById("password-input"),e=document.getElementById("iconPassword");o.type==="password"?(o.type="text",e.classList.remove("bi-eye-fill"),e.classList.add("bi-eye-slash-fill")):(o.type="password",e.classList.remove("bi-eye-slash-fill"),e.classList.add("bi-eye-fill"))},O=()=>{const o=document.getElementById("reset-input"),e=document.getElementById("iconReset");o.type==="password"?(o.type="text",e.classList.remove("bi-eye-fill"),e.classList.add("bi-eye-slash-fill")):(o.type="password",e.classList.remove("bi-eye-slash-fill"),e.classList.add("bi-eye-fill"))},U=o=>{o==="all"&&Object.keys($).forEach(a=>{$[a]=!0}),$[o]=!0;const e=D("login","email",r.email);e!==""?(k[o]=e,x[o]=!0):(k[o]="",x[o]=!1)},E=o=>{o==="all"&&Object.keys(c).forEach(e=>{c[e]=!0}),c[o]=!0,Object.keys(t).forEach(e=>{const a=D("reset",e,t[e]);console.log("Message",a),a!==""?(u[e]=a,v[e]=!0):(u[e]="",v[e]=!1)})},F=()=>!(Object.values(v).filter(e=>e===!0).length>0),q=async()=>{if(E("all"),!F())return;const o={email:t.email,new_password:t.new_password};try{await ne(o),d.value="Contraseña cambiada correctamente",g.value=!1}catch(e){e instanceof Error&&(m.value=e.message)}},N=async()=>{if(w.value=!0,r.email===""||r.password===""){m.value="Por favor, rellene todos los campos",w.value=!1;return}const o=new FormData;o.append("username",r.email),o.append("password",r.password),o.append("grant_type",""),o.append("client_id",""),o.append("client_secret",""),o.append("scope","");try{const e=await Z.login(o);f.user.token=e.token,window.localStorage.setItem("userData",btoa(JSON.stringify({token:e.token,type:e.type}))),H.push({name:"userhome"})}catch{m.value="Usuario o contraseña incorrectos"}finally{w.value=!1}};return(o,e)=>(p(),C(G,null,[s("div",ie,[s("div",de,[s("div",ce,[s("div",ue,[me,s("div",pe,[_(B,{id:"email",type:"email",placeholder:"Correo electrónico",modelValue:r.email,"onUpdate:modelValue":e[0]||(e[0]=a=>r.email=a),onLossFocus:e[1]||(e[1]=a=>U("email")),error:x.email,errorMessage:k.email},null,8,["modelValue","error","errorMessage"]),s("div",we,[P(s("input",{type:"password",class:"border border-gray-300 rounded px-3 py-3",placeholder:"Contraseña","onUpdate:modelValue":e[2]||(e[2]=a=>r.password=a),id:"password-input"},null,512),[[S,r.password]]),s("div",{class:"btn-password",onClick:j},fe)]),_e,s("p",{class:"text-center cursor-pointer",onClick:e[3]||(e[3]=a=>g.value=!0)}," ¿Olvidaste tu contraseña? "),ye,_(V,{text:"Iniciar sesión",loading:w.value,onClick:N},null,8,["loading"])])])])])]),_(re,{show:g.value,onOnClose:e[8]||(e[8]=a=>g.value=!1)},{header:b(()=>[he]),body:b(()=>[s("div",ge,[be,Ce,s("div",$e,[_(B,{id:"emailreset",type:"email",placeholder:"Correo electrónico",modelValue:t.email,"onUpdate:modelValue":e[4]||(e[4]=a=>t.email=a),onLossFocus:e[5]||(e[5]=a=>E("email")),error:v.email,errorMessage:u.email},null,8,["modelValue","error","errorMessage"])]),s("div",ke,[P(s("input",{type:"password",class:"border border-gray-300 rounded px-3 py-3",placeholder:"Contraseña","onUpdate:modelValue":e[6]||(e[6]=a=>t.new_password=a),id:"reset-input",onBlur:e[7]||(e[7]=a=>E("new_password"))},null,544),[[S,t.new_password]]),s("div",{class:"btn-password",onClick:O},Ee)]),v.new_password?(p(),C("p",Ie,K(u.new_password),1)):h("",!0)])]),footer:b(()=>[_(V,{text:"Cambiar contraseña",onClick:q})]),_:1},8,["show"]),m.value?(p(),L(X,{key:0,show:m.value!=="",message:m.value,onClose:e[9]||(e[9]=a=>m.value="")},null,8,["show","message"])):h("",!0),d.value?(p(),L(Y,{key:1,show:d.value!=="",message:d.value,onClose:e[10]||(e[10]=a=>d.value="")},null,8,["show","message"])):h("",!0)],64))}}),De=R(Le,[["__scopeId","data-v-36bd0cfb"]]);export{De as default};
